## 1 $和#区别

在 MyBatis 中，`#{}` 和 `${}` 是两种用于参数替换的方式，它们在处理参数和生成 SQL 语句时有着显著的区别。

`#{}` 是一种预编译的方式，它告诉 MyBatis 创建一个预处理语句（PreparedStatement），并且安全地设置预处理语句的参数。这种方式下，MyBatis 会自动将传入的数据当成一个字符串，并在自动传入的数据两边加上双引号。因此，`#{}` 可以有效防止 SQL 注入攻击。此外，`#{}` 还支持 MyBatis 提供的 OGNL 表达式，可以方便地进行更复杂的参数处理。

`${}` 是一种直接的字符串替换方式，它告诉 MyBatis 将传入的数据直接显示生成在 SQL 语句中。这种方式下，传入的数据不会被当成字符串处理，而是直接替换 SQL 语句中的 `${}` 部分。因此，使用 `${}` 需要注意防止 SQL 注入攻击，确保传入的数据是安全的。此外，`${}` 还支持动态 SQL 语句的拼接，可以用于构建动态的表名和列名等。

总的来说，`#{}` 和 `${}` 的主要区别在于参数的处理方式和 SQL 注入攻击的防护能力。在大多数情况下，推荐使用 `#{}` 来处理参数，因为它可以提供更好的安全性和更灵活的处理方式。只有在需要动态构建 SQL 语句的情况下，才考虑使用 `${}`。同时，在使用 `${}` 时，一定要确保传入的数据是安全的，避免 SQL 注入攻击。



## 2 Dao 接口的工作原理是什么？Dao 接口里的方法，参数不同时，方法能重载吗？

Dao（Data Access Object）接口是数据访问对象，它是用来抽象和封装所有访问数据库的操作。在大多数Java应用程序中，特别是在使用Spring框架时，Dao接口通常与MyBatis或Hibernate等ORM（对象关系映射）框架一起使用，以简化数据库操作。

Dao接口的工作原理可以概括为以下几个步骤：

1. **定义接口**：首先，我们定义一个接口，该接口包含一些与数据库操作相关的方法，例如`findUserById(int id)`或`saveUser(User user)`。
2. **实现接口**：虽然Java要求接口必须被实现，但在使用ORM框架时，实际上并不需要我们手动实现这些接口。相反，框架会在运行时动态地为我们生成实现类。
3. **映射配置**：我们需要为接口中的每个方法提供相应的映射配置，这些配置描述了方法应该如何与数据库进行交互。在MyBatis中，这通常通过XML文件或注解来完成。
4. **调用接口**：在业务逻辑层，我们可以直接调用Dao接口的方法，而无需关心底层的数据库操作。框架会自动处理这些操作，包括打开数据库连接、执行SQL语句、处理结果集以及关闭数据库连接等。

关于Dao接口里的方法重载问题，Java接口中的方法重载与普通的Java类中的方法重载有一些不同。在接口中，由于方法的签名（包括方法名、参数类型和参数顺序）是接口的一部分，因此两个具有相同名称但参数列表不同的方法在接口中是允许的。这就是方法重载的概念。

但是，重要的是要注意，在实际的Dao接口设计中，我们通常会避免使用重载方法，因为这可能会导致映射配置变得复杂和混乱。相反，我们更倾向于为每个不同的数据库操作定义一个独特的方法名，这样可以使代码更加清晰和易于维护。

另外，在使用ORM框架时，重载的方法可能会导致映射配置冲突或不明确，因为框架可能无法准确地确定应该使用哪个映射配置来执行特定的数据库操作。因此，尽管Java语言本身支持方法重载，但在设计Dao接口时，我们通常会避免使用它。



## 3 Mybatis 的缓存原理

MyBatis 是一个优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs (Plain Old Java Objects, 普通的 Java 对象) 映射成数据库中的记录。

MyBatis 的缓存机制是其性能优化的重要手段之一，主要分为一级缓存和二级缓存。

**一级缓存**

一级缓存是 SqlSession 级别的缓存，也就是说只要 SqlSession 没有关闭，那么就可以通过 SqlSession 获取到之前查询过的数据。当执行增删改操作时，会清空一级缓存。一级缓存的作用域是一个 SqlSession，在同一个 SqlSession 中两次执行相同的 SQL 语句，第一次执行完毕会将数据库中查询的数据写入缓存，第二次查询时直接从缓存中获取数据，不再查询数据库，从而提高了查询效率。

**二级缓存**

二级缓存是 Mapper 级别的缓存，多个 SqlSession 可以共享同一个 Mapper 的二级缓存。二级缓存的作用域是 Mapper 的 namespace，不同的 namespace 无法共享二级缓存。当执行增删改操作时，会清空该 namespace 下的二级缓存。二级缓存默认是关闭的，需要手动开启。

MyBatis 的缓存机制是基于 LRU（Least Recently Used，最近最少使用）算法实现的，当缓存满了之后，会淘汰最近最少使用的数据。MyBatis 还提供了对缓存的自定义配置，包括缓存的实现类、是否启用缓存、缓存的生命周期等。

需要注意的是，虽然 MyBatis 的缓存机制可以提高查询效率，但在某些情况下可能会导致数据不一致的问题，因此在使用缓存时需要谨慎考虑其适用场景和限制。例如，当数据频繁更新时，缓存中的数据可能无法及时刷新，导致查询结果不准确。此时可以考虑关闭缓存或者使用其他的数据同步策略来解决问题。

